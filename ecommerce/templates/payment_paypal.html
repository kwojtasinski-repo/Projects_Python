{% extends "base.html" %}

{% block extra_head %}
<style>
  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 7px 14px rgba(50, 50, 93, .10), 0 3px 6px rgba(0, 0, 0, .08);
    background-color: #43458b;
  }
</style>
{% endblock extra_head %}

{% block content %}

  <main >

    <div class="container wow fadeIn">


      <h2 class="my-5 h2 text-center">Payment</h2>


      <div class="row">


        <div class="col-md-12 mb-4">


          <div class="card">

            <div id="paypal-button" class="text-center"></div>

            <script src="https://www.paypalobjects.com/api/checkout.js"></script>

            <script>
                const CREATE_PAYMENT_URL  = 'http://127.0.0.1:8000/payment/paypal/create/';
                const EXECUTE_PAYMENT_URL = 'http://127.0.0.1:8000/payment/paypal/execute/';
                const csrfToken = '{{ csrf_token }}';

                paypal.Button.render({

                    env: 'sandbox', // Or 'sandbox'

                    commit: true, // Show a 'Pay Now' button

                    payment: function() {
                        return paypal.request.post(CREATE_PAYMENT_URL, {}, {
                          headers: {
                            'X-CSRFToken': csrfToken
                          }
                        }).then(function(data) {
                            return data.paymentID;
                        });
                    },

                    onAuthorize: function(data) {
                        return paypal.request.post(EXECUTE_PAYMENT_URL, {
                            paymentID: data.paymentID,
                            payerID:   data.payerID
                        }).then(function(res) {

                            console.log(res.success)
                            // The payment is complete!
                            // You can now show a confirmation message to the customer
                        });
                    }

                }, '#paypal-button');
            </script>

          </div>

        </div>


        {% include "order_snippet.html" %}

      </div>

    </div>
  </main>


{% endblock content %}
